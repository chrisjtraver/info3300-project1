<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script> <!--D3 Library Import-->
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"> </script> <!--JQuery Library Import-->
  <script src="data.js"></script> <!--Arrest Data Import-->
  <link rel="stylesheet" type="text/css" href="style.css"> <!--External CSS Import-->
  <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'> <!--Import Open Sans Font-->
</head>

<style>
.axis path {fill: none; stroke: #aaa;}
.axis line { stroke: black;}
.axis text {font-size: 14px;}
</style>

<body>
<h1 class="center">Trends in Marijuanna Prices & Arrest Locations</h1>
<h3 class="center">Chris Traver, Leila Younes, Chris Yoo</h3>
<div class="gradientScale"></div>
<div class="map"></div>
<br><br><br><br><br><br><br>
<div class="line-chart"></div>

<script>

<!-- ////////////////////////////////////////// SVG FOR GRAIDENT SCALE ///////////////////////////////////////////////////-->

//Attributes for Gradient Scale
var width = 1200,
   height = 100;

//Create Gradient Scale SVG
var svg = d3.select(".gradientScale").append("svg")
    .attr("width", width)
    .attr("height", height)

<!-- ////////////////////////////////////////// GRADIENT FOR PRICES ///////////////////////////////////////////////////-->

gradientColors = ["green","red"]
gradientScale = d3.scale.linear().domain([263.68, 269.11]).range(gradientColors);

var gradientRect = svg.append("defs").append("linearGradient")
    .attr("id", "gradientScale")
    .attr("x1", "0%")
    .attr("y1", "0%")
    .attr("x2", "100%")
    .attr("y2", "0%")

//Leftmost Color
gradientRect.append("stop")
    .attr("stop-color", gradientColors[0])
	.attr("offset", "0%")

//Rightmost Color
gradientRect.append("stop")
    .attr("stop-color", gradientColors[1])
	.attr("offset", "100%")

//Create Gradient Scale Rectangle
svg.append("rect")
    .style("fill", "url(#gradientScale)")
	.attr("x", 40)
    .attr("y", 40)
	.attr("height", 25)
    .attr("width", width)

</script>

<script>

<!-- ////////////////////////////////////////// NYC MAP PROJECTION ///////////////////////////////////////////////////-->

//Attributes for NYC Map
var width = 1200,
   height = 800;

//Create NYC Map
var svg = d3.select(".map").append("svg")
    .attr("width", width)
    .attr("height", height)
	  .attr("class", "map");

  //Map Projection Function
  d3.json("nyc.json", function(error, nyb) {

    var projection = d3.geo.mercator()
  					.center([-73.94, 40.70])
  					.scale(80000)
  					.translate([(width) / 2, (height)/2]);

	var path = d3.geo.path()
			.projection(projection);

	var g = svg.append("g");

	g.append("g")
		.attr("class", "boroughs")
		.selectAll(".state")
		.data(nyb.features)
		.enter().append("path")
		.attr("class", function(d){ return "borough-"+d.properties.boroughCode; })
		.attr("d", path);


<!-- ////////////////////////////////////////// PLOT CIRCLES ON MAP ///////////////////////////////////////////////////-->

	for (i = 0; i < data.length; i++) {
		var lonlat = [data[i].lon, data[i].lat];
		var xy = projection(lonlat)
		svg.append("circle")
		.attr({
		  cx: xy[0],
		  cy: xy[1],
		  r: 5,
		  fill: gradientScale(data[i].price),
		})
		.attr("stroke", "black")
	}

<!-- ////////////////////////////////////////// BOUROUGH LABELS ///////////////////////////////////////////////////-->

//Staten Island
svg.append("text")
				.attr("x", "20%")
				.attr("y", "50%")
				.attr("class", "map-label")
				.text("Staten Island")

//Manhattan
svg.append("text")
				.attr("x", "35%")
				.attr("y", 100)
				.attr("class", "map-label")
				.text("Manhattan")

//Bronx
svg.append("text")
				.attr("x", "70%")
				.attr("y", 100)
				.attr("class", "map-label")
				.text("Bronx")

//Queens
svg.append("text")
				.attr("x", "80%")
				.attr("y", "40%")
				.attr("class", "map-label")
				.text("Queens")

//Brooklyn
svg.append("text")
				.attr("x", "50%")
				.attr("y", "98%")
				.attr("class", "map-label")
				.text("Brooklyn")
});


<!-- ////////////////////////////////////////// LINE CHART ///////////////////////////////////////////////////-->

var widthL = 1000;
var heightL = 500;
var svgLine = d3.select("div.line-chart").append("svg")
              .attr("width", widthL).attr("height", heightL);

// <text x="10" y="100">C</text>
// <text x="100" y="190">A</text>

var parseDate = d3.time.format("%d-%b").parse;

data.forEach(function(d) {
   d.date = parseDate(d.date);
   d.price = +d.price;
})

var padding = 60;
var title = "Title";
var xLabel = "Price";
var yLabel = "Date";

svgLine.append("text").text("Marijuana Prices over Time").attr("x", 370).attr("y", 20)
       .attr("alignment-baseline", "middle").attr("font-size", 30);

var xScale = d3.time.scale().range([padding+5,widthL-padding]);
var yScale = d3.scale.linear().domain([d3.min(data, function(d) { return d.price; }) - 1,
                                       d3.max(data, function(d) { return d.price; }) + 1])
                                       .range([heightL-padding,padding]);

xScale.domain(d3.extent(data, function(d) {return d.date; }));

var xAxis = d3.svg.axis().scale(xScale).orient("bottom").ticks(12)
                         .ticks(d3.time.months).tickSize(16, 0)
                         .tickFormat(d3.time.format("%B"));;
var yAxis = d3.svg.axis().scale(yScale).orient("left").ticks(12)
                          .tickFormat(d3.format("s"));

svgLine.selectAll("circle").data(data)
              .enter().append("circle")
              .attr("class", "dot")
              .attr("r", 3.5)
              .attr("fill", "#2eb82e")
              .attr("cx", function(d) {
                return xScale(d.date);
              })
              .attr("cy", function(d) {
                return yScale(d.price);
              });

svgLine.append("g").attr("transform", "translate(0," + (heightL - padding) + ")")
                        .attr("class", "axis").call(xAxis);

svgLine.append("g").attr("transform", "translate(" + padding + ",0)")
                        .attr("class", "axis").call(yAxis);



// function convertDate(s) {
//   var temp = s.substring(s.length-3, s.length);
//   var orig = s.substring(0, s.length-4);
//
//   switch(s) {
//     case "Jan":
//       s = "1";
//       break;
//     case "Feb":
//       s = "2";
//       break;
//     case "Mar":
//       s = "3";
//       break;
//     case "Apr":
//       s = "4";
//       break;
//     case "May":
//       s = "5";
//       break;
//     case "Jun":
//       s = "6";
//       break;
//     case "July":
//       s = "7";
//       break;
//     case "Aug":
//       s = "8";
//       break;
//     case "Sep":
//       s = "9";
//       break;
//     case "Oct":
//       s = "10";
//       break;
//     case "Nov":
//       s = "11";
//       break;
//     case "Dec":
//       s = "12";
//       break;
//     default:
//       break;
//   }
//   return s+orig;
//
// }



</script>
</body>
</html>
